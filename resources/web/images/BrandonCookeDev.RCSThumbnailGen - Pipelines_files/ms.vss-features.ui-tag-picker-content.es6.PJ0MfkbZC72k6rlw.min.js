"use strict";define("VSSUI",["require","exports","react","VSS/Core/Observable","VSS/Core/TimerManagement"],function(e,t,s,i,n){var a;!function(e){a=t.ComponentsTagPickerTagPicker={},Object.defineProperty(t,"__esModule",{value:!0});t.ComponentsTagPickerTagPicker.TagPicker=class extends s.Component{constructor(e){super(e),this.inputElement=s.createRef(),this.outerElement=s.createRef(),this.textValue=new i.ObservableValue(""),this.suggestionsVisible=new i.ObservableValue(!1),this.selectedIndex=new i.ObservableValue(-1),this.selectableTags=new i.ObservableArray([]),this.suggestionsLoaded=(()=>(-1===this.selectedIndex.value&&!i.ObservableLike.getValue(this.props.suggestionsLoading)&&this.inputElement.current&&""!==this.inputElement.current.value&&(this.updateIndexTimer&&window.cancelAnimationFrame(this.updateIndexTimer),this.updateIndexTimer=window.requestAnimationFrame(()=>{this.selectedIndex.value=0})),!0)),this.createGenericItem=((e,t)=>{const s=this.props.createDefaultItem&&this.props.createDefaultItem(e);if(!s||!t.some(e=>this.props.areTagsEqual(s,e)))return s}),this.onBlur=(()=>{this.textValue.value="",this.selectableTags.value=[],this.props.onBlur&&this.props.onBlur(),this.onSuggestionsDismiss()}),this.onOuterKeyDown=(e=>{switch(e.which){case 46:case 8:!e.isDefaultPrevented()&&this.selectableTags.value.length>0&&(this.props.onTagsRemoved&&this.props.onTagsRemoved(this.selectableTags.value),this.selectableTags.value=[],this.focusInput(),e.preventDefault())}}),this.onKeyDown=(e=>{const t=e.which,s=this.inputElement.current,n=this.suggestionsVisible.value,a=i.ObservableLike.getValue(this.props.suggestions);switch(t){case 27:this.onSuggestionsDismiss(),e.preventDefault();break;case 9:case 13:if(!e.shiftKey)if(n)this.completeSuggestion(),e.preventDefault();else if(this.props.createDefaultItem){const t=this.createGenericItem(this.textValue.value,i.ObservableLike.getValue(this.props.selectedTags));t&&this.addItem(t),e.preventDefault()}break;case 38:n&&(this.selectedIndex.value=Math.max(0,this.selectedIndex.value-1),e.preventDefault());break;case 40:n?(this.selectedIndex.value=Math.min(a.length-1,this.selectedIndex.value+1),e.preventDefault()):""===this.textValue.value?(this.props.onEmptyInputFocus&&this.props.onEmptyInputFocus(),this.suggestionsVisible.value=!0,e.preventDefault()):(this.suggestionsVisible.value=!0,e.preventDefault());break;case 39:n&&a&&a[this.selectedIndex.value]&&this.props.onSuggestionExpanded&&s&&s.value.length===s.selectionEnd&&(this.props.onSuggestionExpanded(a[this.selectedIndex.value]),e.preventDefault())}}),this.onInputClick=(e=>{this.props.onEmptyInputFocus&&this.props.onEmptyInputFocus(),this.suggestionsVisible.value=!0,e&&e.preventDefault()}),this.onInputChange=(e=>{this.textValue.value=e.target.value,this.selectedIndex.value=-1,this.onResolveInput(e),e.persist(),e.preventDefault()}),this.onResolveInput=(e=>{this.props.onSearchChanged(e.target.value),this.suggestionsVisible.value=!0}),this.onTagClicked=((e,t)=>{if(!e||!e.isDefaultPrevented()){const s=this.indexOfTag(t,this.selectableTags.value);if(!this.props.onTagsRemoved)return;s<0?this.selectableTags.push(t):this.selectableTags.splice(s,1),e&&e.preventDefault()}}),this.onTagRemoved=(e=>{const t=this.indexOfTag(e,this.selectableTags.value);t>=0&&this.selectableTags.splice(t,1);const s=this.props.selectedTags.length;this.props.onTagRemoved(e),s!=this.props.selectedTags.length&&this.inputElement.current&&this.inputElement.current.focus()}),this.onTagPickerSizeChanged=((e,t)=>{this.setState({width:e})}),this.completeSuggestion=(()=>{const e=i.ObservableLike.getValue(this.props.suggestions)[this.selectedIndex.value];e&&this.addItem(e)}),this.onSuggestionClick=(e=>{this.addItem(e.item)}),this.addItem=(e=>{this.suggestionsVisible.value=!1,this.props.onTagAdded(e),this.textValue.value="",this.selectedIndex.value=-1,this.focusInput()}),this.focusInput=(()=>{this.inputElement.current&&(this.inputElement.current.focus(),this.inputElement.current.select())}),this.onSuggestionsDismiss=(()=>{this.suggestionsVisible.value=!1}),this.indexOfTag=((e,t)=>t.findIndex(t=>this.props.areTagsEqual(t,e))),this.state={width:296},this.timerManagement=new n.TimerManagement}render(){const{ariaLabel:e,convertItemToPill:i,noResultsFoundText:n,onTagsRemoved:a,placeholderText:l,prefixIconProps:o,renderSuggestionItem:r,selectedTags:u,suggestions:c,suggestionsLoading:g,suggestionsLoadingText:h}=this.props;return s.createElement(t.FocusWithin.FocusWithin,{onBlur:this.onBlur},d=>s.createElement(s.Fragment,null,s.createElement(t.Observer.Observer,{suggestionsLoading:{observableValue:g,filter:this.suggestionsLoaded},suggestionsVisible:this.suggestionsVisible,selectedIndex:this.selectedIndex,selectableTags:this.selectableTags,selectedTags:u,suggestions:{observableValue:c,filter:this.suggestionsLoaded},textValue:this.textValue},n=>{const r=this.createGenericItem(this.textValue.value,n.suggestions.concat(n.selectedTags));r&&n.suggestions.unshift(r);const u=0===n.selectedTags.length||d.hasFocus?l:void 0,c=!d.hasFocus&&n.selectedTags.length>0&&!n.suggestionsVisible;let g;n.suggestionsVisible&&(g=-1===n.selectedIndex||n.suggestionsLoading?t.Util.getSafeId("sug-list-transition"):n.suggestions&&n.suggestions.length?t.Util.getSafeId(`sug-row-${n.selectedIndex}`):t.Util.getSafeId("sug-list-no-results"));const h=n.suggestionsVisible?t.Util.getSafeId("tag-picker-callout"):void 0;return s.createElement(t.Measure.Measure,{onMeasure:this.onTagPickerSizeChanged},s.createElement("div",{className:t.Util.css("bolt-tag-picker",(d.hasFocus||n.suggestionsVisible)&&"edit"),ref:this.outerElement,onBlur:d.onBlur,onFocus:d.onFocus,onClick:this.focusInput},s.createElement("div",{className:"bolt-tag-picker-group flex-center flex-row flex-wrap",onKeyDown:a&&this.onOuterKeyDown},0===n.selectedTags.length&&o?s.createElement(t.Icon.Icon,Object.assign({},o,{className:t.Util.css(o.className,"bolt-tag-picker-prefix-icon")})):null,n.selectedTags.map((e,l)=>{const o=i(e,l),r=this.indexOfTag(e,n.selectableTags);return s.createElement("div",{key:t.Util.getSafeId("bolt-tag-picker-pill"+l),className:"scroll-hidden"},s.createElement(t.Pill.Pill,Object.assign({},o,{className:t.Util.css("bolt-tag-picker-pill",a&&"bolt-people-picker-pill-selectable",r>=0&&"active"),contentClassName:"text-ellipsis",onClick:t=>{this.onTagClicked(t,e)},onRemoveClick:t=>{this.onTagRemoved(e),t.preventDefault()}}),o.content))}),s.createElement("div",{className:"bolt-tag-picker-add-icon-div flex-row flex-grow"},c&&s.createElement(t.Icon.Icon,{className:"bolt-tag-picker-add-icon cursor-pointer",iconName:"Add"}),s.createElement("input",{"aria-activedescendant":g,"aria-autocomplete":"list","aria-controls":h,"aria-expanded":n.suggestionsVisible,"aria-haspopup":"listbox","aria-label":void 0===e&&u?u:e,className:t.Util.css("bolt-tag-picker-input flex-row flex-grow scroll-hidden",c&&!u&&"hide-input"),onBlur:d.onBlur,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onClick:this.onInputClick,placeholder:u,ref:this.inputElement,role:"combobox",type:"text",value:n.textValue})))))}),s.createElement(t.Observer.Observer,{suggestionsVisible:this.suggestionsVisible,suggestionsLoading:g,selectedIndex:this.selectedIndex,suggestions:c,textValue:this.textValue},e=>e.suggestionsVisible?s.createElement(t.Callout.Callout,{anchorElement:this.outerElement.current||void 0,anchorOrigin:{horizontal:"start",vertical:"end"},calloutOrigin:{horizontal:"start",vertical:"start"},contentClassName:"bolt-tag-picker-callout-content scroll-hidden",contentShadow:!0,id:"tag-picker-callout",role:"presentation"},s.createElement(t.SuggestionsList.SuggestionsList,{isLoading:e.suggestionsLoading,loadingText:h,onBlur:d.onBlur,onFocus:d.onFocus,noResultsFoundText:n,onSuggestionClicked:this.onSuggestionClick,renderSuggestion:r,selectedIndex:e.selectedIndex,suggestions:e.suggestions,width:this.state.width})):s.createElement("div",null))))}componentDidMount(){this.onResolveInput=this.timerManagement.debounce(this.onResolveInput,250)}focus(){this.inputElement.current&&this.inputElement.current.focus()}}}(),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),function(s){for(var i in s)t[e].hasOwnProperty(i)||(t[e][i]=s[i])}(a)}("TagPicker")},["Components/TagPicker/TagPicker","TagPicker"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.ui-tag-picker-content"}}));